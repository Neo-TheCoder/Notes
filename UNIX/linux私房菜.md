


# 第二章 主机规划与磁盘分区
### 2.1.3 各硬件设备在Linux中的文件名
在Linux系统中，每个设备都被当成一个文件来对待
例如：SATA接口的硬盘的文件名称即为/dev/sd\[a-d]
虚拟机内使用/dev/vd\[a-p]

## 2.2 磁盘分区
### 2.2.1 磁盘连接的方式与设备文件名的关系
Linux是使用**侦测到的顺序**来决定设备文件名，并非与实际插槽代号有关

一个硬盘有多个盘片（受体积和成本限制，一般在5片以内），每个盘片包含两个**盘面**，每个盘面对应一个读/写磁头。
盘片的编号自下向上从0开始，如最下边的盘片有0面和1面，再上一个盘片就编号为2面和3面。
一个盘面上，**磁道**是一圈圈的同心圆（从最外层开始编号为0），每个磁道上的一段弧，称为一个**扇区**。扇区是磁盘的最小组成单元（每个扇区通常是4096Byte）
具有相同编号的磁道形成一个圆柱（类似于卷筒纸芯的形状），称之为**柱面**，整个磁盘的柱面数和一个盘面上的磁道数自然是相等的
并且每个盘面都有自己的磁头，因此盘面数等于总的磁头数
磁盘容量计算：存储容量 ＝ 磁头数 × 磁道(柱面)数 × 每道扇区数 × 每扇区字节数
PS：新的硬盘数据的密度都一致，这样磁道的周长越长，扇区就越多，存储的数据量就越大。

**块**是操作系统中最小的逻辑存储单位。操作系统与磁盘打交道的最小单位是磁盘块。通俗的来讲，在Windows下如NTFS等文件系统中叫做簇；在Linux下如Ext4等文件系统中叫做块（block）。
每个簇或者块可以包括2、4、8、16、32、64…2的n次方个扇区。
操作系统与内存操作，是虚拟一个页的概念来作为最小单位。

扇区 <= 块/簇 <= page

整个磁盘的第一个扇区最为重要，因为记录了整个磁盘的重要信息（称为**MBR格式**：Master Boot Record）
但是由于近年来磁盘的容量不断扩大，造成读写上的一些困扰， 甚至有些大于2TB以上的磁盘分区已经让某些操作系统无法存取。因此后来又多了一个新的磁盘分区格式，称为**GPT（GUID partition table）**
硬盘分区后才能有效使用










# 第十九章 开机流程、模块管理与Loader
核心得要**侦测硬件**并**载入适当的驱动程序**后，接下来则必须要调用程序来准备好系统运行的环境，以让使用者能够顺利的操作整部主机系统。

## 19.1 Linux的开机流程分析
### 19.1.1 开机流程一览
目前各大Linux发行版的主流开机管理程序（Boot Loader）是grub2。
按下电源键后，计算机硬件会主动地**读取BIOS（Basic Input Output System）或UEFI BIOS来载入硬件信息**及进行**硬件系统的自我测试**，然后系统就会主动**读取第一个可开机的设备**（由BIOS设置），然后就可以**读入开机管理程序**了。
**boot loader**：可以**指定使用哪个核心文件来开机，并实际载入核心到内存中解压缩和执行**。核心运行时会**侦测所有硬件信息与载入适当的驱动程序使得整部主机开始运行**，然后操作系统就在PC上跑起来了。此时，Linux才会调用外部程序开始准备软件执行的环境，并实际载入所有系统运行所需的软件程序。最后系统就会等待用户的登录与操作。

#### 系统的开机过程
1. 载入 BIOS 的硬件信息与进行自我测试，并依据设置取得第一个可开机的设备；
2. 读取并执行第一个开机设备内MBR（Master Boot Record, 主要开机记录区）的 boot Loader （亦即是 grub2, spfdisk 等程序）；
3. 依据boot loader的设置载入Kernel，Kernel会开始侦测硬件与载入驱动程序；
4. 在硬件驱动成功后，Kernel会主动调用 **systemd** 程序，并以 default.target 流程开机；
    systemd 执行 sysinit.target 初始化系统及 basic.target 准备操作系统；
    systemd 启动 multi-user.target 下的本机与服务器服务；
    systemd 执行 multi-user.target 下的 /etc/rc.d/rc.local 文件；
    systemd 执行 multi-user.target 下的 getty.target 及登陆服务；
    systemd 执行 graphical 需要的服务

PS：MBR是磁盘最前面可安装boot loader的部分

### 19.1.2 BIOS,boot loader与kernel载入
在个人计算机架构下，你想要启动整部系统首先就得要让系统去载入BIOS（Basic Input Output System），并**通过BIOS程序去载入CMOS的信息**，并且借由CMOS内的设置值取得主机的各项硬件设置，例如：CPU与周边设备的沟通频率啊、开机设备的搜寻顺序啊、硬盘的大小与类型啊、系统时间啊、各周边总线的是否启动Plug and Play（PnP, 随插即用设备）啊、各周边设备的I/O位址啊、以及与CPU沟通的IRQ岔断等等的信息。








